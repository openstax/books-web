pipeline {
  agent { label 'docker' }
  stages {
    stage('Build') {
      steps {
        sh "docker build -t openstax/rex-web ."
      }
    }
    stage('Test') {
      steps {
        sh 'docker run openstax/rex-web test'
        sh 'docker run -v $(pwd):/code -v /code/node_modules openstax/rex-web test'
        archiveArtifacts artifacts: '**/*diff.png', fingerprint: true
      }
    }
  }
}
